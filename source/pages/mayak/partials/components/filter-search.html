<!-- s-filter === search-filter -->
<div class="s-filter">
  <h5 class="s-filter__title">Сортировка</h5>
  <form action="#" class="s-filter-sort s-filter__sort">
    <div class="sort-group">
      <input type="radio" name="sort-radio" id="radio-new" class="sort-group__input" value="radio-new">
      <label for="radio-new" class="sort-group__label">Сначала самые новые</label>
    </div>
    <div class="sort-group">
      <input type="radio" name="sort-radio" id="radio-old" class="sort-group__input" value="radio-old">
      <label for="radio-old" class="sort-group__label">Сначала самые старые</label>
    </div>
  </form>

  <h5 class="s-filter__title" style="margin-top: 35px;">Фильтры</h5>
  <form action="#" class="s-filter-form">
    <div class="filter-group filter-group--single">
      <span class="filter-group__title">Тема</span>
      <div class="filter-group-heading">
        <div class="filter-left">
          <span data-role="static-value">Все темы</span>
        </div>
        <div class="filter-right">
          <button type="button" data-role="switch-dropdown" class="filter-right__btn">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6 0L6 4.6L1.4 0L0 1.4L6 7.4L12 1.4L10.6 0Z"
                fill="black" />
            </svg>
          </button>
        </div>
      </div>
      <ul class="dropdown-list">
        <li class="dropdown-list__item" data-value="0">Все темы</li>
        <li class="dropdown-list__item" data-value="1">Если нужен оригинальный препарат</li>
        <li class="dropdown-list__item" data-value="2">
          Являясь всего лишь частью общей картины, многие известные личности объединены. Таким образом, дальнейшее
          развитие различных форм.
        </li>
        <li class="dropdown-list__item" data-value="3">Если нужен оригинальный препарат2</li>
        <li class="dropdown-list__item" data-value="4">Если нужен оригинальный препарат3</li>
        <li class="dropdown-list__item" data-value="5">Если нужен оригинальный препарат4</li>
        <li class="dropdown-list__item" data-value="6">Если нужен оригинальный препарат5</li>
        <li class="dropdown-list__item" data-value="7">Если нужен оригинальный препарат6</li>
      </ul>
    </div>

    <div class="filter-group filter-group--multiple">
      <span class="filter-group__title">Лектор</span>
      <div class="filter-group-heading">
        <div class="filter-left">
          <span data-role="static-value">Все</span>
          <ul class="tags-list">
            <!-- <li class="tags-list__item">
                  <span>Саверский</span>
                  <button type="button" data-role="remove-this-tag">&times;</button>
                </li> -->
          </ul>
        </div>
        <div class="filter-right">
          <button type="button" data-role="delete-tags" class="filter-right__btn">
            <svg width="14" height="18" viewBox="0 0 14 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M11 6V16H3V6H11ZM9.5 0H4.5L3.5 1H0V3H14V1H10.5L9.5 0ZM13 4H1V16C1 17.1 1.9 18 3 18H11C12.1 18 13 17.1 13 16V4Z"
                fill="black" />
            </svg>
          </button>
          <button type="button" data-role="switch-dropdown" class="filter-right__btn">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6 0L6 4.6L1.4 0L0 1.4L6 7.4L12 1.4L10.6 0Z"
                fill="black" />
            </svg>
          </button>
        </div>
      </div>
      <ul class="dropdown-list">
        <li class="dropdown-list__item" data-value="0">Все</li>
        <li class="dropdown-list__item" data-value="1">Саверский</li>
        <li class="dropdown-list__item" data-value="2">Гриценко</li>
        <li class="dropdown-list__item" data-value="3">Иванов</li>
        <li class="dropdown-list__item" data-value="4">Петров</li>
        <li class="dropdown-list__item" data-value="5">Семёнов</li>
        <li class="dropdown-list__item" data-value="6">Пупкин</li>
        <li class="dropdown-list__item" data-value="7">Исаев</li>
      </ul>
    </div>

    <div class="filter-group filter-group--multiple">
      <span class="filter-group__title">Длительность</span>
      <div class="filter-group-heading">
        <div class="filter-left">
          <span data-role="static-value">Выберите длительность</span>
          <ul class="tags-list">
            <!-- <li class="tags-list__item">
                      <span>Саверский</span>
                      <button type="button" data-role="remove-this-tag">&times;</button>
                    </li> -->
          </ul>
        </div>
        <div class="filter-right">
          <button type="button" data-role="delete-tags" class="filter-right__btn">
            <svg width="14" height="18" viewBox="0 0 14 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M11 6V16H3V6H11ZM9.5 0H4.5L3.5 1H0V3H14V1H10.5L9.5 0ZM13 4H1V16C1 17.1 1.9 18 3 18H11C12.1 18 13 17.1 13 16V4Z"
                fill="black" />
            </svg>
          </button>
          <button type="button" data-role="switch-dropdown" class="filter-right__btn">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6 0L6 4.6L1.4 0L0 1.4L6 7.4L12 1.4L10.6 0Z"
                fill="black" />
            </svg>
          </button>
        </div>
      </div>
      <ul class="dropdown-list">
        <li class="dropdown-list__item" data-value="0">Любая</li>
        <li class="dropdown-list__item" data-value="1">0-15 минут</li>
        <li class="dropdown-list__item" data-value="2">15-30 минут</li>
        <li class="dropdown-list__item" data-value="3">30-45 минут</li>
        <li class="dropdown-list__item" data-value="4">45-60 минут</li>
        <li class="dropdown-list__item" data-value="5">60+ минут</li>
      </ul>
    </div>

    <div class="filter-group filter-group--multiple">
      <span class="filter-group__title">Тэги</span>
      <div class="filter-group-heading">
        <div class="filter-left">
          <span data-role="static-value">Выберите тэги</span>
          <ul class="tags-list">
            <!-- <li class="tags-list__item">
                          <span>Саверский</span>
                          <button type="button" data-role="remove-this-tag">&times;</button>
                        </li> -->
          </ul>
        </div>
        <div class="filter-right">
          <button type="button" data-role="delete-tags" class="filter-right__btn">
            <svg width="14" height="18" viewBox="0 0 14 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M11 6V16H3V6H11ZM9.5 0H4.5L3.5 1H0V3H14V1H10.5L9.5 0ZM13 4H1V16C1 17.1 1.9 18 3 18H11C12.1 18 13 17.1 13 16V4Z"
                fill="black" />
            </svg>
          </button>
          <button type="button" data-role="switch-dropdown" class="filter-right__btn">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6 0L6 4.6L1.4 0L0 1.4L6 7.4L12 1.4L10.6 0Z"
                fill="black" />
            </svg>
          </button>
        </div>
      </div>
      <ul class="dropdown-list">
        <li class="dropdown-list__item" data-value="0">Все тэги</li>
        <li class="dropdown-list__item" data-value="1">#Tag1</li>
        <li class="dropdown-list__item" data-value="2">#Tag2</li>
        <li class="dropdown-list__item" data-value="3">#Tag3</li>
        <li class="dropdown-list__item" data-value="4">#Tag4</li>
        <li class="dropdown-list__item" data-value="5">#Tag5</li>
        <li class="dropdown-list__item" data-value="6">#Tag6</li>
        <li class="dropdown-list__item" data-value="7">#Tag7</li>
        <li class="dropdown-list__item" data-value="8">#Tag8</li>
        <li class="dropdown-list__item" data-value="9">#Tag9</li>
        <li class="dropdown-list__item" data-value="10">#Tag10</li>
      </ul>
    </div>
  </form>
</div>

<script>
  let filterGroupsMultiple = document.querySelectorAll('.filter-group--multiple');
  let filterGroupsSingle = document.querySelectorAll('.filter-group--single');

  // Множественный выбор
  for (const group of filterGroupsMultiple) {
    let arrowBtn = group.children[1].querySelector('button[data-role="switch-dropdown"]');
    let deleteTagsBtn = group.children[1].querySelector('button[data-role="delete-tags"]');
    let dropdownBlock = group.children[2];
    let dropdownBlockItem = group.children[2].querySelectorAll('li.dropdown-list__item');
    let tagsBlock = group.children[1].querySelector('ul.tags-list');
    let staticValue = group.children[1].querySelector('span[data-role="static-value"]');
    let arraySelected = [];

    // Показываем кнопку корзины только тогда, когда есть тэги
    function eachClickOnForm() {
      if (tagsBlock.children.length !== 0) {
        deleteTagsBtn.classList.add('btn-delete-tags--visible');
      } else {
        deleteTagsBtn.classList.remove('btn-delete-tags--visible');
        staticValue.style.display = 'inline';
      }

      if (dropdownBlock.children.length === 0) {
        group.classList.remove('is-on');
        dropdownBlock.classList.remove('dropdown-list--visible');
      }
    }

    // Обрабатываем клик по элементу из dropdown
    for (const item of dropdownBlockItem) {

      item.addEventListener('click', (e) => {
        function cretateItemTemplate() {
          let li = document.createElement('li');
          li.className = "tags-list__item";
          li.setAttribute('data-value', item.getAttribute('data-value'));

          let span = document.createElement('span');
          span.textContent = item.innerText;

          let btn = document.createElement('button');
          btn.type = 'button';
          btn.innerHTML = '&times';
          btn.setAttribute('data-role', 'remove-this-tag');
          btn.onclick = function () {
            li.remove();
            item.style.display = 'flex';
            for (let i = 0; i < arraySelected.length; i++) {
              if (arraySelected[i] === li.getAttribute('data-value')) {
                arraySelected[i] = '';
                arraySelected.sort();
                arraySelected.shift();
              }
            }
          }

          li.append(span);
          li.append(btn);

          return li;
        }

        // Добавляем тэг в поле
        staticValue.style.display = 'none';
        tagsBlock.classList.add('tags-list--visible');
        tagsBlock.append(cretateItemTemplate());
        item.style.display = 'none';

        // Добавляем выбранный элемент в массив (для бэкенда)
        arraySelected.push(item.getAttribute('data-value'));
        arraySelected.sort();
      });
    }

    // При клике на стрелочку
    arrowBtn.addEventListener('click', (e) => {
      e.preventDefault();

      group.classList.toggle('is-on');
      dropdownBlock.classList.toggle('dropdown-list--visible');
    });

    // При клике на кнопку корзины
    deleteTagsBtn.addEventListener('click', (e) => {
      e.preventDefault();
      tagsBlock.replaceChildren();
      staticValue.style.display = 'inline';
      dropdownBlockItem.forEach(element => {
        element.style.display = 'flex';
      });
      arraySelected = [];
    });

    // При любом клике на форму, вызываем функцию для корзины
    group.addEventListener('click', (e) => {
      e.stopPropagation();
      eachClickOnForm();

      // КОД НИЖЕ УДАЛИТЬ, ТОЛЬКО ДЛЯ ДЕБАГА!!!
      let formName = group.children[0];
      console.log(`data-values формы [${formName.innerText}]:`, arraySelected);
      console.log('\n');
    });

    // Если кликнули вне формы
    document.addEventListener('click', () => {
      group.classList.remove('is-on');
      dropdownBlock.classList.remove('dropdown-list--visible');
    });
  }

  // Единичный выбор
  for (const group of filterGroupsSingle) {
    let arrowBtn = group.children[1].querySelector('button[data-role="switch-dropdown"]');
    let dropdownBlock = group.children[2];
    let dropdownBlockItem = group.children[2].querySelectorAll('li.dropdown-list__item');
    let staticValue = group.children[1].querySelector('span[data-role="static-value"]');

    // Обрабатываем клик по элементу из dropdown
    for (const item of dropdownBlockItem) {
      item.addEventListener('click', (e) => {
        // Добавляем тэг в поле
        staticValue.textContent = item.innerText;
        staticValue.setAttribute('data-value', item.getAttribute('data-value'));
        dropdownBlock.classList.remove('dropdown-list--visible');
        group.classList.remove('is-on');

        // КОД НИЖЕ УДАЛИТЬ, ТОЛЬКО ДЛЯ ДЕБАГА!!!
        let formName = group.children[0];
        console.log(`data-value формы [${formName.innerText}]:`, `${staticValue.getAttribute('data-value')} - ${staticValue.innerText}`);
        console.log('\n');
      });
    }

    // При клике на стрелочку
    arrowBtn.addEventListener('click', (e) => {
      e.preventDefault();

      group.classList.toggle('is-on');
      dropdownBlock.classList.toggle('dropdown-list--visible');
    });

    // При любом клике на форму, вызываем функцию для корзины
    group.addEventListener('click', (e) => {
      e.stopPropagation();
    });

    // Если кликнули вне формы
    document.addEventListener('click', () => {
      group.classList.remove('is-on');
      dropdownBlock.classList.remove('dropdown-list--visible');
    });
  }
</script>